import subprocess


class CommonPortsCheck:

    def __init__(self, quiet):
        self.quiet = quiet

    # Check common ports using nmap
    def scan_ports(self, url, report):
        if not self.quiet:
            print("[*] Scanning common ports using nmap")
        # Prepare url for nmap
        split_url = url.split('//')
        new_url = split_url[1]
        if '/' in new_url:
            new_url_split = new_url.split('/')
            host = new_url_split[0]
        else:
            host = new_url
        # Execute nmap command and write formatted output to report
        cmd = "nmap " + host
        print(cmd)
        output = subprocess.check_output(cmd, shell=True).decode("utf-8")
        report.write_to_report("\n [*****] Scanning common ports with nmap [*****] \n \n")
        report.write_to_report(output)

        if not self.quiet:
            print("[*] Common ports have been scanned!")
